## 开发中的加密算法

常用加密分为三种：

1. 对称加密（symmetric），例如：AES、DES等
1. 非对称加密（asymmetric），例如：RSA、DSA等
1. 摘要加密（digest），例如：MD5、SHA-1、SHA-256、HMAC等

### 1. 对称加密

常用的算法：DES、3DES、AES、RC4、RC5、RC6

对称加密算法加密和解密使用的是同一个密钥。

场景：双方商定一个密钥，使用密钥进行解析数据。

### 2. 非对称加密

常用的算法：RSA、DSA、ECC、Diffie-Hellman

非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。

场景：服务生成公私钥对，将公钥公开给客户端，服务端使用私钥对数据进行加密，客户端使用公钥对数据进行解密

#### 2.1 RSA

1977年，三位数学家Rivest、Shamir 和 Adleman 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字命名，叫做RSA算法

国际标准算法，应用较早的算法之一，普遍性更强，同比 ECC 算法的适用范围更广，兼容性更好，一般采用2048位的加密长度，服务端性能消耗较高。

#### 2.2 ECC

椭圆加密算法，新一代算法趋势主流，一般采用256位加密长度（相当于 RSA 3072 位加密强度）更安全，抗攻击型更强，同比 RSA 算法加密速度快，效率更高，服务器资源消耗更低。

### 3. 摘要

常用的算法：MD5算法（MD2 、MD4、MD5），SHA算法（SHA1、SHA256、SHA384、SHA512），HMAC算法

严格意义上讲摘要并不算是加密算法，只是哈希值，通过散列算法比如MD5算法就可以得到这个哈希值。
摘要只是用于验证数据完整性和唯一性的哈希值，不管原始数据是什么样的，得到的哈希值都是固定长度的。
摘要并不是原始数据加密后的密文，只是一个验证身份的令牌。所以无法通过摘要解密得到原始数据。

场景：用于信息验证

### 4. 国密算法

国密即国家密码局认定的国产密码算法。主要有SM1，SM2，SM3，SM4。目前SM1算法没有公开，只能集成在芯片中。目前应用较多的是SM2、SM3和SM4算法

#### 4.1 SM2

它是基于椭圆曲线密码（ECC）的公钥密码算法标准，其秘钥长度256bit，包含数字签名、密钥交换和公钥加密，用于替换RSA/DH/ECDSA/ECDH等国际算法。可以满足电子认证服务系统等应用需求。

特点：

- SM2采用的是ECC 256位的一种，其安全强度比RSA 2048位高，且运算速度快于RSA。

- SM2属于非对称加密算法，使用公钥加密，私钥解密，在安全性和运算速度方面要优于RSA算法。

- SM2公钥加密适用于加密长度较短的数据，如会话密钥和消息报文。SM2公钥加密不仅对数据加密，还提供防篡改的特性，即被篡改的或伪造的密文可以在解密的过程中被检查发现，因此通过SM2公钥加密的消息无需格外的校验机制。消息经过SM2公钥加密后长度会增加不到100字节的长度，加密方在准备缓冲区时需要加以留意。

#### 4.2 SM3

SM3属于不可逆加密算法，类似于md5的哈希算法，用于替代MD5/SHA-1/SHA-2等国际算法，适用于数字签名和验证、消息认证码的生成与验证以及随机数的生成，可以满足电子认证服务系统等应用需求。

它是在SHA-256基础上改进实现的一种算法，采用Merkle-Damgard结构，消息分组长度为512bit，输出的摘要值长度为256bit。

#### 4.3 SM4

SM4属于对称加密算法，可用于替代DES/AES等国际算法， SM4算法与AES算法具有相同的密钥长度和分组长度，都是128位。

### 5. JWT 

JWT（Json Web Token）是一个开放标准，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。

JWT由3部分组成：标头(Header)、有效载荷(Payload)和签名(Signature)。在传输的时候，会将JWT的3部分分别进行Base64编码后用.进行连接形成最终传输的字符串

```
JWTString=Base64(Header).Base64(Payload).HMACSHA256(base64UrlEncode(header)+"."+base64UrlEncode(payload),secret)
```

jwt使用的算法最常用的是：HS256（对称加密）和RS256（非对称加密）

RS256 更推荐在生产环境中使用，因为RS256将创建token和校验token的能力分开，只有服务器具备创建的能力，而客户端只具备校验的能力，防止了token被第三方篡改的风险。

接收者校验非对称加密签流程：取出Header和Payload，进行哈希。使用公钥解密数字签名，得到签名的哈希值。接收者将解密签名得到的哈希值和刚使用Header和Payload参与计算的哈希值进行比较。如果两个哈希值相等，则证明JWT确实是由认证服务器创建的。

秘钥文件的保存

1. 本地文件保存：不推荐
2. 保存到秘钥容器中
3. 保存的证书中

### 6. 密钥格式标准

#### 6.1 X509

x509证书主要有2种编码格式，一种是DER格式，另一种是PEM格式。

PEM
PEM 全称为 Privacy-Enhanced Mail ，是一种用于密码学相关的文件的格式。

 由于许多密码学相关的标准都是由 ASN.1 定义数据结构，然后用 Distinguished Encoding Rules (DER) 去序列化这些结构，序列的结果为二进制文件，比如证书、密钥等。纯二进制文件不易在网络中传输，在很多情况下也不套容易展示出来。一般我们通过Base64 或者HEX来编码二进制文件。PEM就使用了Base64编码了二进制文件。

PEM是把二进制数据通过Base64进行编码，然后再头部添加header -----BEGIN XXX----- 尾部添加footer -----END XXX-----。 header 和footer之间的数据就是被Base64编码的二进制数据。XXX 是要编码的数据内容类型，可以是 CERTIFICATE 、CERTIFICATE REQUEST、 PRIVATE KEY 、X509 CRL 。

```
-----BEGIN PRIVATE KEY-----
MIIBzTCCAXCgAwIBAgIGAXKnMKNyMAwGCCqBHM9VAYN1BQAwSTELMAkGA1UEBhMC
Q04xDjAMBgNVBAoTBUdNU1NMMRAwDgYDVQQLEwdQS0kvU00yMRgwFgYDVQQDEw9S
b290Q0EgZm9yIFRlc3Qw
-----END PRIVATE KEY-----
```

一般PEM编码的数据会出现在 后缀为`.pem` 的文件中。也可能出现在其他后缀文件中，比如`.cer`(PEM编码的证书数据，有时候也不用PEM编码，直接就是二进制数据)、`.crt`（PEM编码的证书数据）文件。

#### 6.2 PKCS

PKCS 全称是 Public-Key Cryptography Standards ，是由 RSA 实验室与其它安全系统开发商为促进公钥密码的发展而制订的一系列标准。其中包括证书申请、证书更新、证书作废表发布、扩展证书内容以及数字签名、数字信封的格式等方面的一系列相关协议。

到1999年底，PKCS已经公布了15个标准，其编号分别为PCKS#1~15。其中比较常用的有PKCS#1, PKCS#7, PKCS#8以及PKCS#12。其中PKCS#8 就是私钥的格式标准